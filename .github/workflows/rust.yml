name: Rust tests

on:
  push:
    paths:
      - 'rust/**'
      - '.github/workflows/rust.yml'

env:
  CARGO_TERM_COLOR: always

jobs:
  test_rust:
    name: Test Rust
    runs-on: ubuntu-latest
    if: |
      ! contains(github.event.head_commit.message, '[ci skip]') &&
      ! contains(github.event.head_commit.message, '[skip ci]')
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Cache Rust files
        uses: swatinem/rust-cache@v2
        with:
          workspaces: rust
      - name: Run the tests
        run: |
          cd rust
          ../bin/test_all.sh "Cargo.toml" "cargo test"
